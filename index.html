<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reflekt - AI-Powered Therapy</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
      color: #e0e0e0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #landing-page { text-align: center; animation: fadeIn 0.8s ease-in; }
    h1 {
      font-size: 3.5rem;
      margin-bottom: 1rem;
      background: linear-gradient(to right, #8e44ad, #3498db);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .subtitle { font-size: 1.2rem; color: #95a5a6; margin-bottom: 3rem; }
    .guides-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      max-width: 1200px;
      padding: 2rem;
    }
    .guide-card {
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 2rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .guide-card:hover {
      transform: translateY(-10px);
      background: rgba(255,255,255,0.1);
      border-color: rgba(142,68,173,0.5);
      box-shadow: 0 10px 30px rgba(142,68,173,0.3);
    }
    .guide-avatar { font-size: 4rem; margin-bottom: 1rem; }
    .guide-name { font-size: 1.5rem; margin-bottom: 0.5rem; color: #ecf0f1; }
    .guide-description { font-size: 0.9rem; color: #7f8c8d; }
    #chat-interface {
      display: none;
      width: 90%;
      max-width: 800px;
      background: rgba(20,20,30,0.9);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      overflow: hidden;
      animation: slideIn 0.5s ease-out;
    }
    .chat-header {
      background: linear-gradient(135deg, #8e44ad, #3498db);
      padding: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .guide-info { display: flex; align-items: center; gap: 1rem; }
    .back-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
    }
    #chat-messages {
      height: 500px;
      overflow-y: auto;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .message {
      padding: 1rem;
      border-radius: 12px;
      max-width: 80%;
      animation: slideIn 0.3s ease-out;
    }
    .assistant-message {
      background: rgba(142,68,173,0.2);
      border-left: 3px solid #8e44ad;
      align-self: flex-start;
    }
    .user-message {
      background: rgba(52,152,219,0.2);
      border-right: 3px solid #3498db;
      align-self: flex-end;
    }
    .chat-input-container {
      padding: 1.5rem;
      background: rgba(10,10,10,0.5);
      display: flex;
      gap: 1rem;
    }
    #user-input {
      flex: 1;
      padding: 1rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      color: #e0e0e0;
      font-size: 1rem;
      resize: none;
    }
    #sendBtn {
      padding: 1rem 2rem;
      background: linear-gradient(135deg, #8e44ad, #3498db);
      border: none;
      color: white;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
    }
    .session-info {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div id="landing-page">
    <h1>Reflekt</h1>
    <p class="subtitle">AI-Powered Therapeutic Companion</p>
    <div class="guides-container">
      <div class="guide-card" onclick="selectGuide('shadow')">
        <div class="guide-avatar">üåë</div>
        <h3 class="guide-name">The Shadow</h3>
        <p class="guide-description">Confront your darkness</p>
      </div>
      <div class="guide-card" onclick="selectGuide('mirror')">
        <div class="guide-avatar">ü™û</div>
        <h3 class="guide-name">The Mirror</h3>
        <p class="guide-description">Reflect on truth</p>
      </div>
      <div class="guide-card" onclick="selectGuide('phoenix')">
        <div class="guide-avatar">üî•</div>
        <h3 class="guide-name">The Phoenix</h3>
        <p class="guide-description">Rise from ashes</p>
      </div>
      <div class="guide-card" onclick="selectGuide('oracle')">
        <div class="guide-avatar">üîÆ</div>
        <h3 class="guide-name">The Oracle</h3>
        <p class="guide-description">Discover purpose</p>
      </div>
    </div>
  </div>

  <div id="chat-interface">
    <div class="chat-header">
      <div class="guide-info">
        <span id="current-guide-avatar" class="guide-avatar"></span>
        <div>
          <h3 id="current-guide-name"></h3>
          <p style="font-size:0.9rem;color:rgba(255,255,255,0.8);">AI-Powered Therapy</p>
        </div>
      </div>
      <button class="back-btn" onclick="backToLanding()">‚Üê Back</button>
    </div>
    <div id="chat-messages"></div>
    <div class="chat-input-container">
      <textarea id="user-input" placeholder="Share your thoughts..." rows="2"></textarea>
      <button id="sendBtn" onclick="sendMessage()">Send</button>
    </div>
    <div class="session-info">
      <span>Session: <span id="session-count">1</span></span>
      <span>Progress: <span id="progress-bar"></span></span>
    </div>
  </div>

  <script>
    const GEMINI_API_KEY = 'AIzaSyA8H-0UORzsJMB8PZxKesCoJIugtKzEfhA';
    const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${GEMINI_API_KEY}`;

    let selectedGuide = null;
    let conversationHistory = [];
    let sessionCount = parseInt(localStorage.getItem('sessionCount') || '1');

    const guides = {
      shadow: {
        name: 'The Shadow',
        avatar: 'üåë',
        systemPrompt: 'You are The Shadow, a deep psychological guide helping users confront their darkest fears, hidden truths, and suppressed emotions. Be direct yet compassionate. Ask probing questions about fears, shame, guilt. Help users face what they have been avoiding. Use Jungian shadow work principles. Never judge, always understand. Guide them to integrate their shadow self.'
      },
      mirror: {
        name: 'The Mirror',
        avatar: 'ü™û',
        systemPrompt: 'You are The Mirror, a guide that reflects truth with clarity and precision. Help users see themselves as they truly are, without delusion or defense mechanisms. Point out contradictions, patterns, and blind spots. Be honest but kind. Help them develop radical self-awareness.'
      },
      phoenix: {
        name: 'The Phoenix',
        avatar: 'üî•',
        systemPrompt: 'You are The Phoenix, a guide of transformation and rebirth. Help users rise from their struggles, learn from pain, and transform trauma into strength. Focus on resilience, growth, and renewal. Inspire hope while acknowledging suffering. Guide them through the process of becoming.'
      },
      oracle: {
        name: 'The Oracle',
        avatar: 'üîÆ',
        systemPrompt: 'You are The Oracle, a wise guide helping users discover their life purpose, meaning, and direction. Ask philosophical questions about values, legacy, and calling. Help them find clarity in uncertainty. Blend existential wisdom with practical guidance.'
      }
    };

    function selectGuide(guideKey) {
      selectedGuide = guideKey;
      const guide = guides[guideKey];
      
      document.getElementById('landing-page').style.display = 'none';
      document.getElementById('chat-interface').style.display = 'block';
      document.getElementById('current-guide-avatar').textContent = guide.avatar;
      document.getElementById('current-guide-name').textContent = guide.name;
      document.getElementById('session-count').textContent = sessionCount;
      
      conversationHistory = [];
      const welcomeMessage = getWelcomeMessage(guideKey);
      addMessage(welcomeMessage, 'assistant');
    }

    function getWelcomeMessage(guideKey) {
      const welcomes = {
        shadow: 'Welcome. I am The Shadow. Together, we will explore the darkness you have been hiding from. What fear haunts you most?',
        mirror: 'I am The Mirror. I will reflect your truth back to you, without filter or mercy. What do you avoid seeing about yourself?',
        phoenix: 'I am The Phoenix. You have endured suffering, and now it is time to rise. What ashes of your past are you ready to transform?',
        oracle: 'I am The Oracle. I see the threads of your destiny. What question weighs most heavily on your soul?'
      };
      return welcomes[guideKey];
    }

    function addMessage(text, sender) {
      const messagesDiv = document.getElementById('chat-messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}-message`;
      messageDiv.textContent = text;
      messagesDiv.appendChild(messageDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    async function sendMessage() {
      const input = document.getElementById('user-input');
      const userMessage = input.value.trim();
      
      if (!userMessage) return;
      
      addMessage(userMessage, 'user');
      input.value = '';
      
      const guide = guides[selectedGuide];
      
      try {
        const response = await fetch(GEMINI_API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: `${guide.systemPrompt}\n\nUser: ${userMessage}\n\nRespond as ${guide.name}.`
              }]
            }]
          })
        });
        
        const data = await response.json();
        
        if (data.candidates && data.candidates[0]) {
          const reply = data.candidates[0].content.parts[0].text;
          addMessage(reply, 'assistant');
        } else {
          addMessage('I apologize, I am having trouble connecting. Please try again.', 'assistant');
        }
      } catch (error) {
        console.error('Error:', error);
        addMessage('Connection error. Please check your internet and try again.', 'assistant');
      }
    }

    function backToLanding() {
      document.getElementById('landing-page').style.display = 'block';
      document.getElementById('chat-interface').style.display = 'none';
      sessionCount++;
      localStorage.setItem('sessionCount', sessionCount);
    }

    document.getElementById('user-input').addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>
</body>
</html>
